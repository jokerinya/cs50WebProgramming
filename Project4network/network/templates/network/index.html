{% extends "network/layout.html" %}
{% load static %}

{% block body %}
    {% comment %} Create new posts {% endcomment %}
    {% if user.is_authenticated %}
    <div class="container">
        <h3>All Posts</h3>
        <form action="{% url 'network:index' %}" method="post">
            <div class="form-group">
            {% csrf_token %}
            {{ form.as_p }}
            <input type="submit" value="Post" class="btn btn-success">
            </div>
        </form>
    </div>
    {% endif %}
    {% comment %} Posts  {% endcomment %}
    <div class="container">
        <ul>
        {% for post in posts %}
        <li>
            <hr>
            <h4>{{ post.content }}</h4>
            {% comment %} Like/Unlike Heart {% endcomment %}
            <p class="like_heart">
                {% if user in post.liked_users.all %}
                <i class="fa fa-heart" postId={{post.id}}></i>
                {% else %}
                <i class="fa fa-heart-o" postId={{post.id}}></i> 
                {% endif %}
                <span postId={{post.id}}>{{ post.liked_users.count}}</span>
            </p>
            <p>{{ post.creater.username}} wrote at {{ post.create_time }}</p>
        </li>
        {% endfor %}
        </ul>
        {% comment %} Pagination {% endcomment %}
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if posts.has_previous %}
                    <li class="page-item">
                    <a class="page-link" href="?page={{ posts.previous_page_number }}">Previous</a>
                </li>
                {% else %}
                    <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                </li>
                {% endif %}

                {% if posts.number|add:'-4' > 1 %}
                    <li class="page-item"><a class="page-link" href="?page={{ posts.number|add:'-5' }}">&hellip;</a></li>
                {% endif %}

                {% for i in posts.paginator.page_range %}
                    {% if posts.number == i %}
                        <li class="page-item active" aria-current="page">
                    <span class="page-link">
                        {{ i }}
                        <span class="sr-only">(current)</span>
                    </span>
                    </li>
                    {% elif i > posts.number|add:'-5' and i < posts.number|add:'5' %}
                        <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                    {% endif %}
                {% endfor %}

                {% if posts.paginator.num_pages > posts.number|add:'4' %}
                <li class="page-item"><a class="page-link" href="?page={{ posts.number|add:'5' }}">&hellip;</a></li>
                {% endif %}

                {% if posts.has_next %}
                    <li class="page-item">
                    <a class="page-link" href="?page={{ posts.next_page_number }}">Next</a>
                </li>
                {% else %}
                    <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Next</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
{% endblock %}

{% block script %}
<script src="{% static 'network/index.js' %}" defer></script>
{% if user.is_authenticated %}
    <script src="{% static 'network/like.js' %}" defer></script>
{% endif %}
{% endblock %}